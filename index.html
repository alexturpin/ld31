<!DOCTYPE html>
<html>
	<head>
		<title>LD31</title>
		<meta charset="utf-8">

		<style>
			main {
				width: 600px;
				margin: 50px auto;
			}

			#game {
				border: 1px solid black;
			}
		</style>
	</head>
	<body>
		<main>
			<canvas id="game"></canvas>
		</main>

		<script src="assets/js/physicsjs-full-0.6.0.min.js"></script>
		<script>
			var keyMap = {
				37: 'left',
				38: 'up',
				39: 'right',
				40: 'down'
			};
			var keys = {};

			document.addEventListener("keydown", function(event) {
				var key = keyMap[event.keyCode]
				if (key) keys[key] = true;
			});

			document.addEventListener("keyup", function(event) {
				var key = keyMap[event.keyCode]
				if (key) keys[key] = false;
			});

			Physics(function(world){
				var viewWidth = 512;
				var viewHeight = 512;

				var renderer = Physics.renderer('canvas', {
					el: 'game',
					width: viewWidth,
					height: viewHeight,
					meta: false, // don't display meta data
					styles: {
						// set colors for the circle bodies
						'circle' : {
							strokeStyle: '#351024',
							lineWidth: 1,
							fillStyle: '#d33682',
							angleIndicator: '#351024'
						}
					}
				});

				// add the renderer
				world.add(renderer);
				// render on each step
				world.on('step', function(){
					world.render();
				});

				// bounds of the window
				var viewportBounds = Physics.aabb(0, 0, viewWidth, viewHeight);

				// constrain objects to these bounds
				/*world.add(Physics.behavior('edge-collision-detection', {
					aabb: viewportBounds,
					restitution: 0.99,
					cof: 0.99
				}));*/

				// add a circle
				var player = Physics.body('circle', {
					x: 100, // x-coordinate
					y: 100, // y-coordinate
					vx: 0, // velocity in x-direction
					vy: 0, // velocity in y-direction
					radius: 20
				});

				world.add(player);

				world.add(Physics.body('circle', {
					x: 200, // x-coordinate
					y: 200, // y-coordinate
					vx: 0, // velocity in x-direction
					vy: 0, // velocity in y-direction
					radius: 20
				}));

				// ensure objects bounce when edge collision is detected
				world.add(Physics.behavior('body-impulse-response'));
				world.add(Physics.behavior('body-collision-detection'));
       			world.add(Physics.behavior('sweep-prune'));

				// add some gravity
				//world.add(Physics.behavior('constant-acceleration'));

				// subscribe to ticker to advance the simulation
				Physics.util.ticker.on(function(time){
					world.step(time);

					var vector = null;
					if (keys.up) player.accelerate(new Physics.vector(0, -0.0005));
					if (keys.down) player.accelerate(new Physics.vector(0, 0.0005));
					if (keys.left) player.accelerate(new Physics.vector(-0.0005, 0));
					if (keys.right) player.accelerate(new Physics.vector(0.0005, 0));
				});

				// start the ticker
				Physics.util.ticker.start();
			});
		</script>
	</body>
</html>